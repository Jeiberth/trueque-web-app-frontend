import{_ as U,b as B,r as f,q as v,d as C,I as D,D as x,J as b,c,a as n,F as m,k as S,e as w,M as L,G as N,v as R,t as l,i as A,j as H,o as i,n as q,L as T}from"./index-eWhrK3vB.js";import{f as F}from"./fallback_thing_msg-BHafCOoy.js";const G={class:"message-container"},K={class:"messages"},O={class:"date-separator"},$={class:"message-content"},j={key:0,class:"barter-item"},V=["src","alt"],z={class:"item-text"},J={key:1,style:{width:"100%"}},Y={class:"messageTextContent"},P={class:"date"},Q={class:"input-container"},W=["placeholder"],X={class:"sendButtonText"},Z={__name:"messagesChat",setup(ee){function E(e){e.target.src=F}const{t:_}=B(),u=f(""),r=A(),h=r.getters.getUserId,d=H().query.chatId,g=f(!1),M=e=>{const s=new Date;s.setHours(0,0,0,0);const t=new Date(e);t.setHours(0,0,0,0);const o=new Date(s);o.setDate(o.getDate()-1);const a=Math.round((s-t)/(1e3*60*60*24));return a===0?_("Today"):a===1?_("Yesterday"):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},k=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),p=v(()=>(r.getters.getMessagesByChatId(d)||[]).filter(s=>s._status!=="failed")),I=v(()=>{const e={};return[...p.value].sort((t,o)=>new Date(t.created_at)-new Date(o.created_at)).forEach(t=>{const o=new Date(t.created_at).toDateString();e[o]||(e[o]={date:o,displayDate:M(t.created_at),messages:[]}),e[o].messages.push(t)}),Object.values(e)}),y=async()=>{const e=u.value.trim();if(e)try{u.value="",await r.dispatch("sendNewMessage",{chatId:d,content:e})}catch(s){console.error("Failed to send message:",s)}};return C(async()=>{try{r.commit("RESET_UNREAD_MESSAGES_COUNT",d),r.commit("setLoading",!0),await r.dispatch("fetchMessages",d),await r.dispatch("markMessagesRead",d),D(()=>{const e=document.querySelector(".messages");e==null||e.scrollTo({top:e.scrollHeight})})}finally{r.commit("setLoading",!1)}g.value=!0}),x(()=>{r.commit("RESET_UNREAD_MESSAGES_COUNT",d)}),b(p,()=>{D(()=>{const e=document.querySelector(".messages");e==null||e.scrollTo({top:e.scrollHeight})})},{deep:!0}),(e,s)=>(i(),c("div",G,[n("div",K,[(i(!0),c(m,null,S(I.value,(t,o)=>(i(),c(m,{key:o},[n("div",O,l(t.displayDate),1),(i(!0),c(m,null,S(t.messages,a=>(i(),c("div",{key:a.id,class:q(["message",{sent:a.user_id===T(h),received:a.user_id!==T(h)}])},[n("div",$,[a.thing?(i(),c("div",j,[n("img",{src:a.thing.imagesUrl,alt:a.thing.name,class:"item-image",onError:E},null,40,V),n("p",z,l(e.$t("Hey! I like your "))+l(a.thing.name)+"!",1)])):(i(),c("div",J,[n("p",Y,l(a.content),1)])),n("span",P,l(k(a.created_at)),1)])],2))),128))],64))),128))]),w(n("div",Q,[w(n("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>u.value=t),type:"text",placeholder:e.$t("Type your message..."),class:"inputText",onKeypress:N(y,["enter"])},null,40,W),[[R,u.value]]),n("button",{onClick:y,class:"sendButton"},[n("div",X,l(e.$t("Send")),1)])],512),[[L,g.value]])]))}},oe=U(Z,[["__scopeId","data-v-e47ba24c"]]);export{oe as default};
